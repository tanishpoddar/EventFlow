{% extends "layout.html" %}

{% block title %}{{ event.name }} - EventFlow{% endblock %}

{% block content %}
<div class="event-details-page">
    <div class="event-banner">
        <img src="https://picsum.photos/1200/400?random={{ event.event_id }}" alt="{{ event.name }} banner">
        <div class="banner-overlay">
            <div class="container">
                <h1>{{ event.name }}</h1>
                 {% if session.get('user_role') == 'organizer' %}
                <div class="organizer-actions mt-2">
                    <a href="{{ url_for('edit_event', event_id=event.event_id) }}" class="btn btn-sm btn-secondary">Edit Event</a>
                    <form action="{{ url_for('delete_event', event_id=event.event_id) }}" method="POST" style="display: inline;">
                         <button type="submit" class="btn btn-sm btn-danger">Delete Event</button>
                     </form>
                     <a href="{{ url_for('manage_event_tickets', event_id=event.event_id) }}" class="btn btn-sm btn-secondary">Manage Tickets</a>
                 </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="container event-content mt-4">
        <div class="details-grid">
            <!-- Left Column: Details & Speakers -->
            <div class="details-main">
                 <div class="card mb-4">
                     <div class="card-header"><h2>Event Details</h2></div>
                     <div class="card-body">
                         <p><strong>Date:</strong> {{ event.date.strftime('%A, %B %d, %Y') }}</p>
                         <p><strong>Time:</strong> {{ event.time.strftime('%I:%M %p') }}</p>
                          {% if event.venue %}
                         <p><strong>Location:</strong> {{ event.venue.name }}</p>
                         <p><em>{{ event.venue.address }}, {{ event.venue.city }}, {{ event.venue.state }} {{ event.venue.zip_code }}</em></p>
                          {% if event.venue.capacity %}
                          <p><small>Capacity: {{ event.venue.capacity }}</small></p>
                          {% endif %}
                         {% endif %}
                         <hr class="my-3">
                         <p>{{ event.description | safe }}</p> {# Use safe if description contains HTML #}
                     </div>
                 </div>

                 {% if event.speakers %}
                 <div class="card mb-4">
                      <div class="card-header d-flex justify-content-between align-items-center">
                          <h2>Speakers</h2>
                           {% if session.get('user_role') == 'organizer' %}
                               <a href="{{ url_for('create_speaker', event_id=event.event_id) }}" class="btn btn-sm btn-accent">+ Add Speaker</a>
                           {% endif %}
                      </div>
                     <div class="card-body">
                         {% for speaker in event.speakers %}
                         <div class="speaker-item mb-3">
                             <div class="d-flex justify-content-between align-items-start">
                                 <div>
                                     <strong>{{ speaker.name }}</strong>
                                     {% if speaker.bio %}
                                     <p><small>{{ speaker.bio }}</small></p>
                                     {% endif %}
                                 </div>
                                {% if session.get('user_role') == 'organizer' %}
                                 <div class="actions">
                                      <a href="{{ url_for('edit_speaker', speaker_id=speaker.speaker_id) }}" class="btn btn-sm btn-secondary">Edit</a>
                                      <form action="{{ url_for('delete_speaker', speaker_id=speaker.speaker_id) }}" method="POST" style="display: inline;">
                                         <button type="submit" class="btn btn-sm btn-danger">Del</button>
                                      </form>
                                 </div>
                                {% endif %}
                             </div>
                         </div>
                         {% if not loop.last %}<hr>{% endif %}
                         {% endfor %}
                     </div>
                 </div>
                 {% endif %}

                 <!-- Add other sections like schedule if needed -->
            </div>

             <!-- Right Column: Tickets & Map -->
            <div class="details-sidebar">
                 <div class="card mb-4">
                     <div class="card-header"><h3>Tickets</h3></div>
                     <div class="card-body">
                         {% if ticket_types %}
                             <form method="POST" action="{{ url_for('book_ticket', event_id=event.event_id) }}">
                                 {% for ticket in ticket_types %}
                                     <div class="ticket-option mb-3">
                                         <div class="d-flex justify-content-between align-items-center">
                                             <div>
                                                <span class="ticket-type">{{ ticket.type | title }}</span><br>
                                                <span class="ticket-price">${{ "%.2f"|format(ticket.price) }}</span>
                                             </div>
                                             <div>
                                                 {% if 'user_id' in session and session['user_role'] == 'attendee' %}
                                                    <input type="hidden" name="ticket_type" value="{{ ticket.type }}">
                                                    {# Add quantity selector if needed #}
                                                    <button type="submit" class="btn btn-accent btn-sm">Book Now</button>
                                                 {% elif 'user_id' not in session %}
                                                     <a href="{{ url_for('login', next=request.url) }}" class="btn btn-accent btn-sm">Login to Book</a>
                                                 {% else %}
                                                     {# Organizer view? Maybe disable booking #}
                                                      <button type="button" class="btn btn-secondary btn-sm" disabled>Book</button>
                                                 {% endif %}
                                             </div>
                                         </div>
                                     </div>
                                 {% endfor %}
                             </form>
                         {% else %}
                             <p class="text-muted">Ticket information not available yet.</p>
                         {% endif %}
                         {% if session.get('user_role') == 'organizer' %}
                              <a href="{{ url_for('manage_event_tickets', event_id=event.event_id) }}" class="btn btn-secondary btn-block mt-3">Manage Tickets</a>
                         {% endif %}
                     </div>
                 </div>

                  <div class="card mb-4">
                     <div class="card-header"><h3>Venue Location</h3></div>
                     <div class="card-body">
                         <div class="map-placeholder">
                             {# Replace with an actual map embed (e.g., Google Maps iframe) #}
                             Map Placeholder
                             {% if event.venue %}
                             <p><small>{{ event.venue.address }}, {{ event.venue.city }}</small></p>
                             {% endif %}
                         </div>
                     </div>
                 </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block head_extra %}
<style>
    .event-banner {
        position: relative;
        height: 350px; /* Adjust height as needed */
        overflow: hidden;
    }
    .event-banner img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }
    .banner-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0));
        color: white;
        padding: 2rem 0 1.5rem 0;
    }
     .banner-overlay h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
    }

    .organizer-actions .btn {
        margin-right: 5px;
        background-color: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.5);
        color: white;
    }
     .organizer-actions .btn-danger {
         background-color: rgba(220, 53, 69, 0.7);
         border-color: rgba(220, 53, 69, 1);
     }
     .organizer-actions .btn:hover {
         background-color: rgba(255, 255, 255, 0.3);
     }


    .details-grid {
        display: grid;
        grid-template-columns: 2fr 1fr; /* 2/3 for main content, 1/3 for sidebar */
        gap: 2rem;
    }

    .speaker-item strong { display: block; font-size: 1.1em; }
    .speaker-item small { color: #555; }
    .speaker-item .actions { margin-left: auto; white-space: nowrap;}
    .speaker-item .actions .btn { margin-left: 5px;}


    .ticket-option .ticket-type { font-weight: 500; text-transform: capitalize; }
    .ticket-option .ticket-price { font-size: 1.2em; font-weight: bold; color: var(--primary-color); }
    .btn-block { display: block; width: 100%; }


    .map-placeholder {
        height: 200px;
        background-color: var(--secondary-color);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        color: #666;
        border-radius: var(--border-radius);
    }
    .map-placeholder small { margin-top: 0.5rem;}


    hr.my-3 { margin-top: 1rem; margin-bottom: 1rem; border-top: 1px solid var(--border-color); }

    @media (max-width: 992px) {
        .details-grid {
            grid-template-columns: 1fr; /* Stack columns on smaller screens */
        }
    }
     @media (max-width: 768px) {
        .event-banner { height: 250px; }
        .banner-overlay h1 { font-size: 2rem; }
    }
</style>
{% endblock %}
